title: NEFS 存储集群规划
date: 2017-01-24 14:29:48
tags:
---

###  1. 111

从之前的几份分析文档。副本数载系统中基本定义为3副本，那么在此基础上，最大的要点是加快恢复时间，在加快恢复时间的基础上，能够尽量较小组合CopySet的数目。


从恢复时间角度，理论上来说，Nefs只要CopySet(Partition) 越多，能够并发参与恢复的磁盘越多，恢复时间就越快。但是一个大的存储系统，往往恢复速度不是受限于磁盘，而是受限于交换机的带宽。[如下图可以看到]


	
8*1024*1024/3600 = 2330 MB, 大约需要 233 块磁盘参与。


按照我们系统规划。一个Pool的机器规模3\*9\*3 = 81 台机器， 81\*36=2916 块盘，系统预计空间 2916\*8T*0.7/3= 5.4PB 逻辑存储量。


以下计算一个Pool下，按照1个小时恢复时间，如何合理规划Copy 使得 系统可靠性达到最佳

### 1. 如何根据自身系统划定自身集群的规模



* 副本数
* 恢复速度（恢复时间）


假设单盘容量为8T，使用率为70%，数据分片大小为1GB，在一个1000块磁盘的集群中，不同恢复时间的年故障率对比为：





以10PB容量空间作为一个Pool，需要的机器数量10*1024/(8*36/3)=106台机器，106*36=3816块盘，10GB分片大小，







8*1024/10 = 819个分片 ，理论上可以利用整个机器中的机器进行数据恢复。

恢复速度 200M  8*1024*1024/200 = 301989600/3600 = 11.65 小时

恢复速度 400M  8*1024*1024/400 = 301989600 = 5.82 小时

恢复速度 600M  8*1024*1024/600 = 301989600 = 3.88 小时

恢复速度 800M  8*1024*1024/800 = 301989600 = 2.91 小时



10GB分片其实导致copy set 数目会变多。但是恢复速度上不去的情况下，太多其实意义不是很大。

假设20GB，8*1024/20 = 419个分片。 也能够充分利用106/3=28块盘的




PS1: 数据丢失的基本维度简单定义为一个磁盘，即不存在磁盘坏一半其他继续可用使用的情况下，只要磁盘出现坏块（发生在有数据的块上），就定义为一次磁盘故障。

参考文献：

1. [分布式系统设计模式][1]

2. [Google’s Disk Failure Experience][2]

3. [柏松分布][3]

4. [泊松分布和指数分布：10分钟教程][4]

5. [概率论，二项分布和Poisson分布](http://blog.sina.com.cn/s/blog_4cd69a6c01000c44.html)


* 总体丢失概率:

![](http://tom.nos-eastchina1.126.net/2017-01-24-storage-durablity-3.jpg)


![](http://tom.nos-eastchina1.126.net/2017-01-24-storage-durablity-2.jpg)

![](http://tom.nos-eastchina1.126.net/2017-01-24-storage-durablity-5.jpg?imageView&thumbnail=0x500&enlarge=1&quality=100)
